
<html>
<head>

  <title>Data Table</title>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}

#searchform{
  font-size: 20;
}
</style>

</head>
<body>

<h2>Data Table</h2>

<table id = "table">
  <tr style= "font-size: 20px; background-color:steelblue;">
    <th>naziv</th>
    <th>marka</th>
    <th>model</th>
    <th>gorivo</th>
    <th>godinaproizvodnje</th>
    <th>snagaMotora</th>
    <th>maxBrzina</th>
    <th>masa</th>
    <th>potrosnjaGoriva</th>
    <th>mjenjac</th>
  </tr>
 
</table>

</br>
</br>

<form id="searchform" action="javascript:obrazac()" method="get" name="searchform">
    <div id="pretraga">
        <label for="vrijednost">Polje za pretragu: </label>
        <input type="text" name="name" id="value" required> Unesite vrijednost
      </div>
    <select id = "select" required>
        <option selected value="" disabled selected>Odaberite polje za pretragu
        </option>
        <option value="svi">Sva polja</option>
        <option value="naziv">naziv</option>
        <option value="marka">marka</option>
        <option value="model">model</option>
        <option value="gorivo">gorivo</option>
        <option value="godinaproizvodnje">godinaProizvodnje</option>
        <option value="snagamotora">snagaMotora</option>
        <option value="masa">masa</option>
        <option value="potrosnjagoriva">potrosnjaGoriva</option>
        <option value="mjenjac">mjenjac</option>
      </select>
    <input type="submit" id="searchbutton" value="Filtriraj" />
 </form>

</br>
</br>
<button  onclick="generate()"> 
  restart
</button>

</br>
</br>

</body>
</html>

<script >

    generate();

    async function obrazac(){
        let value = document.getElementById('value').value;
        let filter = document.getElementById('select').value;

        const data = {value,filter};

        const response = await fetch('datatable/filter', {
         method: 'POST',
         headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
         body: JSON.stringify(data)
         });
        const filtriraniAuti = await response.json();
        
        stvori(filtriraniAuti);

        JsonFields = ["naziv","marka","model","gorivo",
                  "godinaproizvodnje","snagamotora","maxbrzina","masa",
                  "potrosnjagoriva","mjenjac"]
        let idk = JsonToCSV(filtriraniAuti,JsonFields);

        const downloads = document.createElement('div');
        downloads.id = "d";
        document.body.appendChild(downloads);


        downloadCSV(idk);
        downloads.appendChild(document.createElement('br'))
        downloadJSON(filtriraniAuti)
    }

    function downloadJSON(auti){
        j = document.createElement('a');
        j.text='downloadJSON'
        j.download="filtriraniAuti.json"
        j.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(auti));
        document.getElementById("d").appendChild(j);
    }

    function JsonToCSV(auti,JsonFields){

      var csvStr = JsonFields.join(",") + "\n";

      auti.forEach(element => {
        naziv = element.naziv;
        marka  = element.marka;
        model   = element.model
        gorivo  = element.gorivo
        godinaproizvodnje = element.godinaproizvodnje;
        snagamotora = element.snagamotora;
        maxbrzina  = element.maxbrzina;
        masa   = element.masa
        potrosnjagoriva  = element.potrosnjagoriva
        mjenjac = element.mjenjac;

        csvStr += naziv + ',' + marka + ','  + model + ',' + gorivo +
        ',' + godinaproizvodnje + ',' + snagamotora + ',' + maxbrzina +
        ',' + masa + ',' + potrosnjagoriva + ',' + mjenjac +"\n";
        })
        return csvStr;
}
    
    function downloadCSV(csvStr) {
      a=document.createElement('a');
      a.textContent='downloadCSV';
      a.download="filtriraniAuti.csv";
      a.href='data:text/csv;charset=utf-8,'+escape(csvStr);
      document.getElementById("d").appendChild(a);
    }
      
    async function generate(){
    ocisti();
    const response = await fetch('/data');
    const auti = await response.json();

    stvori(auti);

}

    function ocisti(){
      if(document.getElementById("d") !== null)
      document.body.removeChild(document.body.lastChild);

  const root = document.getElementById('table');
  while (root.childNodes.length > 2) {
    root.removeChild(root.lastChild);
}
}

    function stvori(auti){
  ocisti();
  const root = document.getElementById('table');

  for(auto of auti){
    const redak = document.createElement('tr');
        redak.id= `${auto.naziv}`;
        root.append(redak);

        let value = document.createElement('th');
        value.textContent = `${auto.naziv}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.marka}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.model}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.gorivo}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.godinaproizvodnje}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.snagamotora}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.maxbrzina}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.masa}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.potrosnjagoriva}`;
        redak.append(value);

        value = document.createElement('th');
        value.textContent = `${auto.mjenjac}`;
        redak.append(value);
}

}
</script>